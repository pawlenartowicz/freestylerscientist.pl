<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html"><link rel="next" title="Tutorial: Using Custom Scenarios" href="custom-scenarios.html"><link rel="prev" title="Tutorial: Nested Random Effects" href="mixed-nested.html">

    <!-- Generated with Sphinx 7.4.7 and Furo 2025.12.19 -->
        <title>Tutorial: Using test_formula - MCPower</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=7bdb33bb" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=d26f3b38" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  --color-brand-primary: #5B4460;
  --color-brand-content: #5B4460;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #B88FC2;
  --color-brand-content: #B88FC2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #B88FC2;
  --color-brand-content: #B88FC2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">MCPower</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="https://freestylerscientist.pl/">
  <span style="font-size: 0.85em; color: var(--color-foreground-secondary);">
    by <strong>Paweł Lenartowicz</strong>
  </span>
</a>
<div style="margin-top: 0.5em; font-size: 0.8em;">
  <a href="https://freestylerscientist.pl/about-me/" style="color: var(--color-foreground-muted);">About the author</a>
  &nbsp;&middot;&nbsp;
  <a href="https://freestylerscientist.pl/support_me/" style="color: var(--color-foreground-muted);">Support this project</a>
</div><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Tutorials</a><input aria-label="Toggle navigation of Tutorials" checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="first-analysis.html">Tutorial: Your First Power Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="sample-size.html">Tutorial: Finding the Right Sample Size</a></li>
<li class="toctree-l2"><a class="reference internal" href="interactions.html">Tutorial: Testing Interactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="correlations.html">Tutorial: Correlated Predictors</a></li>
<li class="toctree-l2"><a class="reference internal" href="own-data.html">Tutorial: Power Analysis with Your Own Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="csv-preparation.html">Tutorial: Preparing Your CSV for MCPower</a></li>
<li class="toctree-l2"><a class="reference internal" href="anova-posthoc.html">Tutorial: ANOVA &amp; Post-Hoc Pairwise Comparisons</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiple-testing.html">Tutorial: Controlling for Multiple Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="mixed-intercepts.html">Tutorial: Random Intercepts for Clustered Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="mixed-slopes.html">Tutorial: Random Slopes</a></li>
<li class="toctree-l2"><a class="reference internal" href="mixed-nested.html">Tutorial: Nested Random Effects</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Tutorial: Using test_formula</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom-scenarios.html">Tutorial: Using Custom Scenarios</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../concepts/index.html">Concepts</a><input aria-label="Toggle navigation of Concepts" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/effect-sizes.html">Effect Sizes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/variable-types.html">Variable Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/correlations.html">Correlations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/scenario-analysis.html">Scenario Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/mixed-effects.html">Mixed-Effects Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/performance.html">Performance</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">API Reference</a><input aria-label="Toggle navigation of API Reference" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/constructor.html">MCPower() Constructor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/power-analysis.html">Power Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/data.html">Data &amp; Clustering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/scenarios.html">Scenario Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/corrections.html">Correction Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/progress.html">Progress Reporting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/return-values.html">Return Values</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../model-specification.html">Model Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../limitations.html">Limitations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validation.html">How It Is Validated</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lme-validation.html">LME Validation (vs R’s lme4)</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/tutorials/test-formula.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="tutorial-using-test-formula">
<h1>Tutorial: Using test_formula<a class="headerlink" href="#tutorial-using-test-formula" title="Link to this heading">¶</a></h1>
<p><strong>Goal:</strong> Evaluate how model misspecification affects statistical power – for example, what happens to your power when you omit a variable or ignore clustering.</p>
<hr class="docutils" />
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#full-working-example">Full Working Example</a></p></li>
<li><p><a class="reference internal" href="#how-it-works">How It Works</a></p></li>
<li><p><a class="reference internal" href="#use-case-1-omitted-variable-bias">Use Case 1: Omitted Variable Bias</a></p></li>
<li><p><a class="reference internal" href="#use-case-2-ignoring-clustering-lme-to-ols">Use Case 2: Ignoring Clustering (LME to OLS)</a></p></li>
<li><p><a class="reference internal" href="#use-case-3-factor-variable-omission">Use Case 3: Factor Variable Omission</a></p></li>
<li><p><a class="reference internal" href="#interpreting-results">Interpreting Results</a></p></li>
<li><p><a class="reference internal" href="#gotchas-and-limitations">Gotchas and Limitations</a></p></li>
<li><p><a class="reference internal" href="#see-also">See Also</a></p></li>
</ul>
</section>
<hr class="docutils" />
<section id="full-working-example">
<h2>Full Working Example<a class="headerlink" href="#full-working-example" title="Link to this heading">¶</a></h2>
<p>You have a study with three predictors, but you suspect a reviewer will ask: “What if <code class="docutils literal notranslate"><span class="pre">x3</span></code> doesn’t matter – how does dropping it change your power?”</p>
<div class="cell tag_remove-stderr docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mcpower</span><span class="w"> </span><span class="kn">import</span> <span class="n">MCPower</span>

<span class="c1"># Define the full model (data generation)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">MCPower</span><span class="p">(</span><span class="s2">&quot;y = x1 + x2 + x3&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_simulations</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_effects</span><span class="p">(</span><span class="s2">&quot;x1=0.5, x2=0.3, x3=0.3&quot;</span><span class="p">)</span>

<span class="c1"># Test with the reduced model (omit x3 from analysis)</span>
<span class="n">model</span><span class="o">.</span><span class="n">find_power</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">test_formula</span><span class="o">=</span><span class="s2">&quot;y = x1 + x2&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Effects: x1=0.5, x2=0.3, x3=0.3
Model settings applied successfully
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================================================================================
MONTE CARLO POWER ANALYSIS RESULTS
================================================================================

Power Analysis Results (N=100):
Test                                     Power    Target   Status  
-------------------------------------------------------------------
overall                                  100.0    80       ✓       
x1                                       99.0     80       ✓       
x2                                       80.2     80       ✓       

Result: 3/3 tests achieved target power
</pre></div>
</div>
</div>
</div>
<p>MCPower generates data from the full three-predictor model (where <code class="docutils literal notranslate"><span class="pre">x3</span></code> truly affects <code class="docutils literal notranslate"><span class="pre">y</span></code>), but fits the two-predictor model during analysis. This reveals the power impact of omitting a real predictor.</p>
</section>
<hr class="docutils" />
<section id="how-it-works">
<h2>How It Works<a class="headerlink" href="#how-it-works" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">test_formula</span></code> parameter separates data generation from statistical testing:</p>
<ol class="arabic simple">
<li><p><strong>Data generation</strong> always uses the formula you passed to <code class="docutils literal notranslate"><span class="pre">MCPower()</span></code>. All predictors contribute to the simulated outcome according to their effect sizes.</p></li>
<li><p><strong>Statistical testing</strong> uses the <code class="docutils literal notranslate"><span class="pre">test_formula</span></code> instead. Only the variables in this formula are included in the fitted model.</p></li>
</ol>
<p>This means the simulated data reflects reality (the full model), while the analysis reflects what a researcher would actually fit (the reduced model). The resulting power estimates tell you how well the reduced model detects effects when the full model is true.</p>
<p>The test formula must be a <strong>subset</strong> of the generation formula variables – you cannot introduce new variables that were not part of data generation.</p>
</section>
<hr class="docutils" />
<section id="use-case-1-omitted-variable-bias">
<h2>Use Case 1: Omitted Variable Bias<a class="headerlink" href="#use-case-1-omitted-variable-bias" title="Link to this heading">¶</a></h2>
<p>The most common use case: you want to know how dropping a predictor affects power for the remaining effects.</p>
<div class="cell tag_remove-stderr docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mcpower</span><span class="w"> </span><span class="kn">import</span> <span class="n">MCPower</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">MCPower</span><span class="p">(</span><span class="s2">&quot;y = x1 + x2 + x3&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_simulations</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_effects</span><span class="p">(</span><span class="s2">&quot;x1=0.5, x2=0.3, x3=0.3&quot;</span><span class="p">)</span>

<span class="c1"># Full model -- baseline power</span>
<span class="n">model</span><span class="o">.</span><span class="n">find_power</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Reduced model -- omit x3</span>
<span class="n">model</span><span class="o">.</span><span class="n">find_power</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">test_formula</span><span class="o">=</span><span class="s2">&quot;y = x1 + x2&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Effects: x1=0.5, x2=0.3, x3=0.3
Model settings applied successfully
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================================================================================
MONTE CARLO POWER ANALYSIS RESULTS
================================================================================

Power Analysis Results (N=100):
Test                                     Power    Target   Status  
-------------------------------------------------------------------
overall                                  100.0    80       ✓       
x1                                       99.5     80       ✓       
x2                                       81.5     80       ✓       
x3                                       83.2     80       ✓       

Result: 4/4 tests achieved target power
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================================================================================
MONTE CARLO POWER ANALYSIS RESULTS
================================================================================

Power Analysis Results (N=100):
Test                                     Power    Target   Status  
-------------------------------------------------------------------
overall                                  100.0    80       ✓       
x1                                       99.0     80       ✓       
x2                                       80.2     80       ✓       

Result: 3/3 tests achieved target power
</pre></div>
</div>
</div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">x3</span></code> is omitted but truly affects the outcome, its effect becomes part of the residual variance. This typically:</p>
<ul class="simple">
<li><p>Inflates the error term, reducing power for the remaining predictors</p></li>
<li><p>May bias coefficient estimates if the omitted variable is correlated with included predictors</p></li>
</ul>
<p>Compare the power output from both calls to quantify this impact.</p>
</section>
<hr class="docutils" />
<section id="use-case-2-ignoring-clustering-lme-to-ols">
<h2>Use Case 2: Ignoring Clustering (LME to OLS)<a class="headerlink" href="#use-case-2-ignoring-clustering-lme-to-ols" title="Link to this heading">¶</a></h2>
<p>You have clustered data (e.g., students nested in schools) but want to know what happens if you ignore the clustering and fit a simple OLS model instead.</p>
<div class="cell tag_remove-stderr docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mcpower</span><span class="w"> </span><span class="kn">import</span> <span class="n">MCPower</span>

<span class="c1"># Full model: mixed-effects with clustering</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">MCPower</span><span class="p">(</span><span class="s2">&quot;y ~ treatment + covariate + (1|school)&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_simulations</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_cluster</span><span class="p">(</span><span class="s2">&quot;school&quot;</span><span class="p">,</span> <span class="n">ICC</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_effects</span><span class="p">(</span><span class="s2">&quot;treatment=0.5, covariate=0.3&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_variable_type</span><span class="p">(</span><span class="s2">&quot;treatment=binary&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_max_failed_simulations</span><span class="p">(</span><span class="mf">0.10</span><span class="p">)</span>

<span class="c1"># Correct analysis: mixed model</span>
<span class="n">model</span><span class="o">.</span><span class="n">find_power</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1"># Misspecified analysis: ignore clustering, fit OLS</span>
<span class="n">model</span><span class="o">.</span><span class="n">find_power</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">test_formula</span><span class="o">=</span><span class="s2">&quot;y ~ treatment + covariate&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variable types: treatment=(binary,0.5)
Cluster variables configured: school
Effects: treatment=0.5, covariate=0.3
Model settings applied successfully
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================================================================================
MONTE CARLO POWER ANALYSIS RESULTS
================================================================================

Power Analysis Results (N=1000):
Test                                     Power    Target   Status  
-------------------------------------------------------------------
overall                                  100.0    80       ✓       
treatment                                100.0    80       ✓       
covariate                                100.0    80       ✓       

Result: 3/3 tests achieved target power
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================================================================================
MONTE CARLO POWER ANALYSIS RESULTS
================================================================================

Power Analysis Results (N=1000):
Test                                     Power    Target   Status  
-------------------------------------------------------------------
overall                                  100.0    80       ✓       
treatment                                100.0    80       ✓       
covariate                                100.0    80       ✓       

Result: 3/3 tests achieved target power
</pre></div>
</div>
</div>
</div>
<p>The data is generated with cluster-level variance (ICC = 0.2), but the test formula drops the random effect <code class="docutils literal notranslate"><span class="pre">(1|school)</span></code>. The OLS model treats all observations as independent, which:</p>
<ul class="simple">
<li><p>Underestimates standard errors (observations within a cluster are correlated)</p></li>
<li><p>Can produce misleadingly high power – the model is overconfident about detecting effects</p></li>
</ul>
<p>This comparison helps justify including random effects in your analysis plan.</p>
</section>
<hr class="docutils" />
<section id="use-case-3-factor-variable-omission">
<h2>Use Case 3: Factor Variable Omission<a class="headerlink" href="#use-case-3-factor-variable-omission" title="Link to this heading">¶</a></h2>
<p>You want to see what happens when a categorical predictor is dropped from the model.</p>
<div class="cell tag_remove-stderr docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mcpower</span><span class="w"> </span><span class="kn">import</span> <span class="n">MCPower</span>

<span class="c1"># Full model: continuous predictor + 3-level factor</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">MCPower</span><span class="p">(</span><span class="s2">&quot;y = x1 + group&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_simulations</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_variable_type</span><span class="p">(</span><span class="s2">&quot;group=(factor,3)&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">set_effects</span><span class="p">(</span><span class="s2">&quot;x1=0.5, group[2]=0.3, group[3]=0.4&quot;</span><span class="p">)</span>

<span class="c1"># Full model -- baseline</span>
<span class="n">model</span><span class="o">.</span><span class="n">find_power</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Reduced model -- drop the factor</span>
<span class="n">model</span><span class="o">.</span><span class="n">find_power</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">test_formula</span><span class="o">=</span><span class="s2">&quot;y = x1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variable types: group=(factor,3 levels)
Expanded 1 factors
Effects: x1=0.5, group[2]=0.3, group[3]=0.4
Model settings applied successfully
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================================================================================
MONTE CARLO POWER ANALYSIS RESULTS
================================================================================

Power Analysis Results (N=100):
Test                                     Power    Target   Status  
-------------------------------------------------------------------
overall                                  99.8     80       ✓       
x1                                       100.0    80       ✓       
group[2]                                 20.2     80       ✗       
group[3]                                 35.0     80       ✗       

Result: 2/4 tests achieved target power
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================================================================================
MONTE CARLO POWER ANALYSIS RESULTS
================================================================================

Power Analysis Results (N=100):
Test                                     Power    Target   Status  
-------------------------------------------------------------------
overall                                  100.0    80       ✓       
x1                                       100.0    80       ✓       

Result: 2/2 tests achieved target power
</pre></div>
</div>
</div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">group</span></code> is omitted, the between-group variance it explains becomes part of the residual. The power for <code class="docutils literal notranslate"><span class="pre">x1</span></code> will change depending on whether <code class="docutils literal notranslate"><span class="pre">x1</span></code> and <code class="docutils literal notranslate"><span class="pre">group</span></code> are correlated.</p>
</section>
<hr class="docutils" />
<section id="interpreting-results">
<h2>Interpreting Results<a class="headerlink" href="#interpreting-results" title="Link to this heading">¶</a></h2>
<p>When comparing full-model and reduced-model power:</p>
<p><strong>Power decreases for remaining predictors:</strong> This is the typical result when the omitted variable explains real outcome variance. The unexplained variance increases, making it harder to detect remaining effects.</p>
<p><strong>Power stays roughly the same:</strong> The omitted variable contributes little to outcome variance, or it is uncorrelated with the remaining predictors. Omitting it has minimal impact.</p>
<p><strong>Power increases (rare but possible):</strong> This can happen when the test formula has fewer parameters to estimate, freeing up degrees of freedom. It is more likely with small effect sizes for the omitted variable and no correlation with remaining predictors.</p>
<p><strong>Ignoring clustering inflates power:</strong> When you drop random effects from a mixed model, the OLS analysis treats clustered observations as independent. Standard errors are underestimated, p-values are too small, and power appears higher than it truly is. This is a false gain – the Type I error rate is inflated.</p>
</section>
<hr class="docutils" />
<section id="gotchas-and-limitations">
<h2>Gotchas and Limitations<a class="headerlink" href="#gotchas-and-limitations" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>Test formula must be a subset.</strong> Every variable in the test formula must also appear in the generation formula. You cannot add new variables that were not part of data generation.</p></li>
<li><p><strong>Effect sizes apply to the generation formula.</strong> The <code class="docutils literal notranslate"><span class="pre">set_effects()</span></code> call defines how data is generated. The test formula only controls which model is fitted during analysis – it does not change the data.</p></li>
<li><p><strong>Target tests must match the test formula.</strong> If you use <code class="docutils literal notranslate"><span class="pre">target_test</span></code>, the requested effects must exist in the test formula, not just the generation formula. For example, if you omit <code class="docutils literal notranslate"><span class="pre">x3</span></code> from the test formula, you cannot request <code class="docutils literal notranslate"><span class="pre">target_test=&quot;x3&quot;</span></code>.</p></li>
<li><p><strong>Interactions and the test formula.</strong> If the generation formula includes <code class="docutils literal notranslate"><span class="pre">x1:x2</span></code>, the test formula can omit the interaction. But if the test formula includes <code class="docutils literal notranslate"><span class="pre">x1:x2</span></code>, it should also include <code class="docutils literal notranslate"><span class="pre">x1</span></code> and <code class="docutils literal notranslate"><span class="pre">x2</span></code> as main effects (standard regression practice).</p></li>
<li><p><strong>Mixed model convergence.</strong> When the generation formula has random effects but the test formula does not, convergence is not an issue (OLS always converges). When both formulas have random effects, the test formula’s random-effects structure determines convergence behavior.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../api/power-analysis.html"><span class="std std-doc">API: find_power()</span></a> – Full parameter reference including <code class="docutils literal notranslate"><span class="pre">test_formula</span></code></p></li>
<li><p><a class="reference internal" href="../api/power-analysis.html"><span class="std std-doc">API: find_sample_size()</span></a> – Sample size search with <code class="docutils literal notranslate"><span class="pre">test_formula</span></code></p></li>
<li><p><a class="reference internal" href="first-analysis.html"><span class="std std-doc">Tutorial: Your First Power Analysis</span></a> – Getting started with MCPower</p></li>
<li><p><a class="reference internal" href="../concepts/mixed-effects.html"><span class="std std-doc">Mixed-Effects Models</span></a> – Clustered and longitudinal data</p></li>
<li><p><a class="reference internal" href="../concepts/effect-sizes.html"><span class="std std-doc">Concept: Effect Sizes</span></a> – How to choose effect sizes</p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="custom-scenarios.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Tutorial: Using Custom Scenarios</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="mixed-nested.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Tutorial: Nested Random Effects</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025–2026, Paweł Lenartowicz
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/pawlenartowicz/MCPower" aria-label="GitHub"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg></a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Tutorial: Using test_formula</a><ul>
<li><a class="reference internal" href="#table-of-contents">Table of Contents</a></li>
<li><a class="reference internal" href="#full-working-example">Full Working Example</a></li>
<li><a class="reference internal" href="#how-it-works">How It Works</a></li>
<li><a class="reference internal" href="#use-case-1-omitted-variable-bias">Use Case 1: Omitted Variable Bias</a></li>
<li><a class="reference internal" href="#use-case-2-ignoring-clustering-lme-to-ols">Use Case 2: Ignoring Clustering (LME to OLS)</a></li>
<li><a class="reference internal" href="#use-case-3-factor-variable-omission">Use Case 3: Factor Variable Omission</a></li>
<li><a class="reference internal" href="#interpreting-results">Interpreting Results</a></li>
<li><a class="reference internal" href="#gotchas-and-limitations">Gotchas and Limitations</a></li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=2bd037f0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>