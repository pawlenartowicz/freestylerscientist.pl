<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ if not .IsHome }}{{ .Title }} — {{ end }}{{ .Site.Title }}</title>
  <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Title }} — Freestyler Scientist{{ end }}">
  <meta name="author" content="Paweł Lenartowicz">
  <link rel="canonical" href="{{ .Permalink }}">

  {{/* Open Graph */}}
  <meta property="og:title" content="{{ .Title }}">
  <meta property="og:description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Title }} — Freestyler Scientist{{ end }}">
  {{ $ogImage := printf "%simages/Workshops-1024x1024.jpg" .Site.BaseURL }}
  {{ with .Params.image }}{{ with $.Resources.GetMatch . }}{{ $ogImage = .Permalink }}{{ end }}{{ end }}
  <meta property="og:image" content="{{ $ogImage }}">
  <meta property="og:site_name" content="{{ .Site.Title }}">
  <meta property="og:url" content="{{ .Permalink }}">
  <meta property="og:type" content="{{ cond (or .IsHome .IsSection) "website" "article" }}">
  {{ if not (or .IsHome .IsSection) -}}
  <meta property="article:author" content="Paweł Lenartowicz">
  {{ with .Date }}{{ if not .IsZero }}<meta property="article:published_time" content="{{ .Format "2006-01-02" }}">{{ end }}{{ end }}
  {{- end }}
  <meta name="twitter:card" content="summary_large_image">

  {{/* JSON-LD Structured Data */}}
  {{ if .IsHome }}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "Paweł Lenartowicz",
    "url": "{{ .Site.BaseURL }}",
    "jobTitle": "Independent Scientist",
    "affiliation": [
      {"@type": "Organization", "name": "Society for Open Science", "url": "https://stowarzyszenieotwartejnauki.pl"},
      {"@type": "Organization", "name": "Center for Brain Research, Jagiellonian University", "url": "https://cbr.uj.edu.pl"}
    ],
    "sameAs": [
      "https://bsky.app/profile/freestylerscientist.pl",
      "https://github.com/pawlenartowicz",
      "https://orcid.org/0000-0002-6906-7217"
    ]
  }
  </script>
  {{ else if eq .Params.schema "SoftwareApplication" }}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "{{ .Title }}",
    "description": "{{ .Description }}",
    "author": {"@type": "Person", "name": "Paweł Lenartowicz"},
    "url": "{{ .Permalink }}",
    "applicationCategory": "Science",
    "operatingSystem": "Windows, macOS, Linux",
    "offers": {"@type": "Offer", "price": "0", "priceCurrency": "USD"}
  }
  </script>
  {{ else if eq .Params.schema "ScholarlyArticle" }}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ScholarlyArticle",
    "name": "{{ .Title }}",
    "description": "{{ .Description }}",
    "author": {"@type": "Person", "name": "Paweł Lenartowicz"},
    "url": "{{ .Permalink }}"
    {{ with .Date }}{{ if not .IsZero }},"datePublished": "{{ .Format "2006-01-02" }}"{{ end }}{{ end }}
  }
  </script>
  {{ end }}

  {{/* Favicon */}}
  <link rel="icon" href="/images/cropped-fav3.png" sizes="32x32">

  {{/* Fonts */}}
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&family=DM+Sans:wght@400;500;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">

  {{/* CSS */}}
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <a href="/" class="site-title">{{ .Site.Title }}</a>
      <button class="menu-toggle" aria-label="Toggle menu">Menu</button>
      <nav class="site-nav">
        {{ range .Site.Menus.main }}
          <a href="{{ .URL }}"{{ if $.IsMenuCurrent "main" . }} class="active"{{ end }}>{{ .Name }}</a>
        {{ end }}
      </nav>
    </div>
  </header>

  <main class="site-main">
    {{ block "main" . }}{{ end }}
  </main>

  <footer class="site-footer">
    <div class="footer-inner">
      <p>&copy; {{ now.Year }} {{ .Site.Title }}</p>
    </div>
  </footer>

  <script>
    document.querySelector('.menu-toggle').addEventListener('click', function() {
      document.querySelector('.site-nav').classList.toggle('open');
      this.textContent = this.textContent === 'Menu' ? 'Close' : 'Menu';
    });

    // Auto-generate IDs for headings without them (HTML content doesn't get Hugo's auto-IDs)
    document.querySelectorAll('h1, h2, h3, h4, h5, h6').forEach(function(heading) {
      if (!heading.id) {
        heading.id = heading.textContent.trim().toLowerCase()
          .replace(/[^\w\s-]/g, '').replace(/\s+/g, '-');
      }
    });

    // Scroll to hash target after IDs are generated (browser tried before JS ran)
    if (window.location.hash) {
      var target = document.querySelector(window.location.hash);
      if (target) target.scrollIntoView();
    }
  </script>
</body>
</html>
